# GitHub Actions Runner Controller (ARC) - EphemeralRunnerSet
#
# NOTE: This resource is typically auto-generated by the ARC controller
# when you deploy an AutoscalingRunnerSet. It manages the ephemeral runner pods.
# This file is provided as a reference for the runner pod configuration.
#
# Before applying manually, you must:
#   1. Replace {organization-name-here} with your GitHub org or org/repo
#   2. Ensure the referenced secret exists in your cluster
#
apiVersion: actions.github.com/v1alpha1
kind: EphemeralRunnerSet
metadata:
  annotations:
    actions.github.com/runner-group-name: Default
    actions.github.com/runner-scale-set-name: arc-runner-set
  labels:
    actions.github.com/organization: {organization-name-here}  # <-- REPLACE
    actions.github.com/scale-set-name: arc-runner-set
    actions.github.com/scale-set-namespace: arc-runners
    app.kubernetes.io/component: runner-set
    app.kubernetes.io/instance: arc-runner-set
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: arc-runner-set
    app.kubernetes.io/part-of: gha-runner-scale-set
    app.kubernetes.io/version: 0.13.0
    helm.sh/chart: gha-rs-0.13.0
  name: arc-runner-set
  namespace: arc-runners
spec:
  ephemeralRunnerSpec:
    githubConfigSecret: arc-runner-set-gha-rs-github-secret
    githubConfigUrl: https://github.com/{organization-name-here}  # <-- REPLACE (org or org/repo)
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: workload-type
                    operator: In
                    values:
                      - build-runner
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: app.kubernetes.io/part-of
                    operator: In
                    values:
                      - gha-runner-scale-set
              topologyKey: kubernetes.io/hostname
      containers:
        - command:
            - /home/runner/run.sh
          image: ghcr.io/actions/actions-runner:latest
          name: runner
          # Resource requests/limits - ADJUST FOR YOUR INSTANCE TYPE
          # These values are tuned for AWS EC2 c8i.4xlarge (16 vCPU, 32GB RAM)
          # Modify based on your node size, or remove to use defaults
          resources:
            limits:
              cpu: '15'
              memory: 26Gi
            requests:
              cpu: '15'
              memory: 26Gi
      restartPolicy: Never
      serviceAccountName: arc-runner-set-gha-rs-no-permission
